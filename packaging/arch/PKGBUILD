# Maintainer: Niche-Knack Apps <support@niche-knack.com>
pkgname=verify-me
pkgver=0.1.0
pkgrel=1
pkgdesc="Text-to-Speech and Voice Cloning desktop application"
arch=('x86_64')
url="https://github.com/niche-knack/verify-me"
license=('Apache-2.0')
depends=(
    'webkit2gtk-4.1'
    'gtk3'
    'cairo'
    'pango'
    'gdk-pixbuf2'
    'libappindicator-gtk3'
    'librsvg'
)
makedepends=(
    'rust'
    'cargo'
    'nodejs'
    'npm'
    'pkg-config'
    'openssl'
)
provides=('verify-me')
conflicts=('verify-me-bin' 'verify-me-git')
source=(
    "$pkgname-$pkgver.tar.gz::https://github.com/niche-knack/verify-me/archive/v$pkgver.tar.gz"
)
sha256sums=('SKIP')

build() {
    cd "$srcdir/$pkgname-$pkgver"
    npm ci
    cd src-tauri
    cargo build --release
}

package() {
    cd "$srcdir/$pkgname-$pkgver"

    install -Dm755 "src-tauri/target/release/$pkgname" \
        "$pkgdir/usr/bin/$pkgname"

    install -Dm644 /dev/stdin "$pkgdir/usr/share/applications/$pkgname.desktop" << EOF
[Desktop Entry]
Name=Verify Me
Comment=Text-to-Speech and Voice Cloning
Exec=verify-me %F
Icon=verify-me
Terminal=false
Type=Application
Categories=AudioVideo;Audio;
Keywords=tts;speech;voice;cloning;
EOF

    for size in 32 128 256; do
        if [[ -f "src-tauri/icons/${size}x${size}.png" ]]; then
            install -Dm644 "src-tauri/icons/${size}x${size}.png" \
                "$pkgdir/usr/share/icons/hicolor/${size}x${size}/apps/$pkgname.png"
        fi
    done
    if [[ -f "src-tauri/icons/icon.png" ]]; then
        install -Dm644 "src-tauri/icons/icon.png" \
            "$pkgdir/usr/share/icons/hicolor/512x512/apps/$pkgname.png"
    fi

    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE" 2>/dev/null || true
}
